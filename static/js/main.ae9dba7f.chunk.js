(window["webpackJsonpinstagram-clone"]=window["webpackJsonpinstagram-clone"]||[]).push([[0],{106:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(27),o=n.n(c),l=(n(80),n(62)),i=n(26),u=n.n(i),s=n(33),d=n(7),m=(n(29),n(19)),g=n(63),p=n(64),b=n.n(p),f=function(){return window.history.replaceState({},document.title,window.location.pathname)},v=r.a.createContext(),h=function(){return Object(a.useContext)(v)};var E=function(){var e=h(),t=e.isAuthenticated,n=e.loginWithRedirect,a=e.user;return r.a.createElement("nav",{className:"Nav"},r.a.createElement("div",{className:"Nav-menus"},r.a.createElement("div",{className:"Nav-brand"},r.a.createElement(m.b,{className:"Nav-brand-logo",to:"/"},"Instagram")),!t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"Nav-user-button button-no-style",onClick:function(){return n({})}})),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement(m.b,{className:"Nav-user-button",to:"/user/"+a.sub}))))},O=n(12),j=n(10),w=n(9);function I(){var e=Object(O.a)(["\n  mutation($postId: Int!, $userId: String!) {\n    delete_Like(\n      where: { user_id: { _eq: $userId }, post_id: { _eq: $postId } }\n    ) {\n      affected_rows\n    }\n  }\n"]);return I=function(){return e},e}function y(){var e=Object(O.a)(["\n  mutation($postId: Int!, $userId: String!) {\n    insert_Like(objects: [{ post_id: $postId, user_id: $userId }]) {\n      affected_rows\n    }\n  }\n"]);return y=function(){return e},e}function k(){var e=Object(O.a)(["\n  query($id: Int!, $userId: String!) {\n    Post(where: { id: { _eq: $id } }) {\n      Likes_aggregate {\n        aggregate {\n          count\n        }\n      }\n      Likes(where: { user_id: { _eq: $userId } }) {\n        id\n      }\n    }\n  }\n"]);return k=function(){return e},e}var _=Object(j.a)(k()),N=Object(j.a)(y()),S=Object(j.a)(I());var $=function(e){var t=h(),n=t.isAuthenticated,c=t.user,o=Object(a.useState)(!1),l=Object(d.a)(o,2),i=l[0],u=l[1],s=Object(a.useState)(-1),m=Object(d.a)(s,2),g=m[0],p=m[1],b=Object(a.useRef)(null);b.current=n?c.sub:"none";var f=Object(w.a)(N,{variables:{postId:e.postId,userId:b.current},refetchQueries:[{query:_,variables:{id:e.postId,userId:b.current}}]}),v=Object(d.a)(f,1)[0],E=Object(w.a)(S,{variables:{postId:e.postId,userId:b.current},refetchQueries:[{query:_,variables:{id:e.postId,userId:b.current}}]}),O=Object(d.a)(E,1)[0],j=Object(w.b)(_,{variables:{id:e.postId,userId:b.current}}),I=j.loading,y=j.error,k=j.data;return I?"Loading...":y?"Error! ".concat(y.message):(-1===g&&(k.Post[0].Likes.length>0&&u(!0),p(k.Post[0].Likes_aggregate.aggregate.count)),r.a.createElement("div",{className:"post-like-container"},n&&r.a.createElement(r.a.Fragment,null,!i&&r.a.createElement("button",{className:"post-like-button-white button-nodec",onClick:function(){v(),u(!0),p(g+1)}}),i&&r.a.createElement("button",{className:"post-like-button-black button-nodec",onClick:function(){O(),u(!1),p(g-1)}})),g?r.a.createElement("span",{className:"Post-likes"},g," likes"):null))};function P(e){return function(e,t){var n=e-t;return n<2e4?"just now":n<6e4?"less than 1 min ago":n<36e5?Math.round(n/6e4)+" min ago":n<864e5?Math.round(n/36e5)+" h ago":n<2592e6?Math.round(n/864e5)+" days ago":n<31536e6?Math.round(n/2592e6)+" mo ago":Math.round(n/31536e6)+" years ago"}((new Date).getTime(),new Date(e).getTime())}var q=n(108);function x(){var e=Object(O.a)(["\n  query($id: Int!) {\n    Post(where: { id: { _eq: $id } }) {\n      id\n      caption\n      created_at\n      url\n      User {\n        avatar\n        id\n        name\n      }\n    }\n  }\n"]);return x=function(){return e},e}var F=Object(j.a)(x());var C=function(e){var t=e.id?e.id:e.match.params.id,n=Object(w.b)(F,{variables:{id:t}}),a=n.loading,c=n.error,o=n.data;return a?"":c?"Error! ".concat(c.message):r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a,null,o.Post.map(function(e,n){return r.a.createElement("article",{className:"Post",key:n},r.a.createElement("header",null,r.a.createElement("div",{className:"Post-user"},r.a.createElement("div",{className:"Post-user-avatar"},r.a.createElement(m.b,{to:"/user/"+e.User.id},r.a.createElement("img",{alt:e.User.name,src:e.User.avatar}))),r.a.createElement("div",{className:"Post-user-nickname"},r.a.createElement(m.b,{className:"anchor-nodec",to:"/user/"+e.User.id},r.a.createElement("span",null,e.User.name))))),r.a.createElement("div",{className:"Post-image"},r.a.createElement("div",{className:"Post-image-bg"},r.a.createElement("img",{alt:e.caption,src:e.url}))),r.a.createElement($,{postId:t}),r.a.createElement("div",{className:"Post-caption"},r.a.createElement(m.b,{className:"anchor-nodec",to:"/user/"+e.User.id},r.a.createElement("strong",null,e.User.name)),"\xa0",e.caption),r.a.createElement("div",{className:"Post-time"},P(e.created_at)))})))},U=n(25),L=n(109),R=n(110),T=n(112);function W(){var e=Object(O.a)(["\n  mutation($followingId: String!, $userId: String!) {\n    delete_Follow(\n      where: {\n        follower_id: { _eq: $userId }\n        following_id: { _eq: $followingId }\n      }\n    ) {\n      affected_rows\n    }\n  }\n"]);return W=function(){return e},e}function A(){var e=Object(O.a)(["\n  mutation($followingId: String!, $userId: String!) {\n    insert_Follow(\n      objects: [{ follower_id: $userId, following_id: $followingId }]\n    ) {\n      affected_rows\n    }\n  }\n"]);return A=function(){return e},e}function D(){var e=Object(O.a)(["\n  query($followingId: String!, $userId: String!) {\n    Follow(\n      where: {\n        follower_id: { _eq: $userId }\n        following_id: { _eq: $followingId }\n      }\n    ) {\n      id\n    }\n  }\n"]);return D=function(){return e},e}var M=Object(j.a)(D()),B=Object(j.a)(A()),Q=Object(j.a)(W());var z=function(e){var t=h(),n=t.isAuthenticated,c=t.user,o=Object(a.useState)(!1),l=Object(d.a)(o,2),i=l[0],u=l[1],s=Object(a.useRef)(!0),m=Object(a.useRef)(null);m.current=n?c.sub:"none";var g=Object(w.a)(B,{variables:{followingId:e.id,userId:m.current},refetchQueries:[{query:M,variables:{followingId:e.id,userId:m.current}},{query:G,variables:{id:e.id}},{query:Z,variables:{id:m.current}}]}),p=Object(d.a)(g,1)[0],b=Object(w.a)(Q,{variables:{followingId:e.id,userId:m.current},refetchQueries:[{query:M,variables:{followingId:e.id,userId:m.current}},{query:G,variables:{id:e.id}},{query:Z,variables:{id:m.current}}]}),f=Object(d.a)(b,1)[0],v=Object(w.b)(M,{variables:{followingId:e.id,userId:m.current}}),E=v.loading,O=v.error,j=v.data;return E?"Loading...":O?"Error! ".concat(O.message):(s.current&&(j.Follow.length>0&&u(!0),s.current=!1),r.a.createElement("div",{className:"post-like-container"},!i&&r.a.createElement(T.a,{variant:"outline-secondary",className:"profile-logout",onClick:function(){p(),u(!0)}},"Follow"),i&&r.a.createElement(T.a,{variant:"outline-success",className:"profile-logout",onClick:function(){f(),u(!1)}},"Following")))};function J(){var e=Object(O.a)(["\n  query($id: String!) {\n    Follow_aggregate(where: { following_id: { _eq: $id } }) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return J=function(){return e},e}function H(){var e=Object(O.a)(["\n  query($id: String!) {\n    Follow_aggregate(where: { follower_id: { _eq: $id } }) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return H=function(){return e},e}function V(){var e=Object(O.a)(["\n  query($id: String!) {\n    User(where: { id: { _eq: $id } }) {\n      email\n      avatar\n      last_seen\n      name\n      Posts_aggregate {\n        aggregate {\n          count\n        }\n      }\n    }\n    Post(where: { user_id: { _eq: $id } }) {\n      url\n      caption\n      id\n    }\n  }\n"]);return V=function(){return e},e}var Y=Object(j.a)(V()),Z=Object(j.a)(H()),G=Object(j.a)(J());var K=Object(U.f)(function(e){var t=h(),n=t.isAuthenticated,a=t.logout,c=t.user,o=function(){return c.sub===e.match.params.id},l=Object(w.b)(Y,{variables:{id:e.match.params.id}}),i=l.loading,u=l.error,s=l.data,d=Object(w.b)(G,{variables:{id:e.match.params.id}}),g=Object(w.b)(Z,{variables:{id:e.match.params.id}});return i?"Loading...":u?"Error! ".concat(u.message):g.loading?"Loading...":d.loading?"Loading...":g.error?"Error! ".concat(u.message):d.error?"Error! ".concat(u.message):r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a,{className:"container"},r.a.createElement(q.a,{className:"profile-details"},s.User.map(function(t,c){return r.a.createElement(L.a,{key:c},r.a.createElement(R.a,{xs:4},r.a.createElement("img",{className:"profile-avatar",alt:t.name,src:t.avatar})),r.a.createElement(R.a,null,r.a.createElement(L.a,null,r.a.createElement(R.a,{className:"profile-username",xs:"auto"},t.name),r.a.createElement(R.a,{className:"profile-logout",xs:4},n&&r.a.createElement(r.a.Fragment,null,o()&&r.a.createElement(r.a.Fragment,null,r.a.createElement(T.a,{variant:"outline-secondary",className:"profile-logout",onClick:function(){return a()}},"Log Out")),!o()&&r.a.createElement(z,{id:e.match.params.id})))),r.a.createElement(L.a,null,r.a.createElement(R.a,{className:"profile-stats",xs:"auto"},r.a.createElement("strong",null,t.Posts_aggregate.aggregate.count)," ","posts"),r.a.createElement(R.a,{className:"profile-stats",xs:"auto"},r.a.createElement("strong",null,d.data.Follow_aggregate.aggregate.count)," ","followers"),r.a.createElement(R.a,{className:"profile-stats",xs:"auto"},r.a.createElement("strong",null,g.data.Follow_aggregate.aggregate.count)," ","following"))))})),r.a.createElement("hr",null),r.a.createElement(L.a,null,s.Post.map(function(e,t){return r.a.createElement(m.b,{to:"/post/"+e.id,key:t},r.a.createElement(R.a,{xs:4,className:"profile-grid"},r.a.createElement("div",{class:"profile-post-image"},r.a.createElement("img",{className:"profile-post-image",alt:e.caption,src:e.url}))))}))))});function X(){var e=Object(O.a)(["\n  {\n    Post(order_by: { created_at: desc }) {\n      id\n    }\n  }\n"]);return X=function(){return e},e}var ee=Object(j.a)(X());var te=function(e){var t=Object(w.b)(ee),n=t.loading,a=t.error,c=t.data;return n?"Loading...":a?"Error! ".concat(a.message):r.a.createElement(r.a.Fragment,null,c.Post.map(function(e,t){return r.a.createElement(C,{id:e.id,key:t})}))},ne=n(111);function ae(){var e=Object(O.a)(["\n  mutation($url: String!, $userId: String!, $caption: String!) {\n    insert_Post(objects: { url: $url, caption: $caption, user_id: $userId }) {\n      affected_rows\n    }\n  }\n"]);return ae=function(){return e},e}var re=Object(j.a)(ae());var ce=function(){var e=r.a.useState(!1),t=Object(d.a)(e,2),n=t[0],c=t[1],o=h().user,l=Object(a.useState)(""),i=Object(d.a)(l,2),u=i[0],s=i[1],m=Object(a.useState)(""),g=Object(d.a)(m,2),p=g[0],b=g[1],f=Object(a.useState)(""),v=Object(d.a)(f,2),E=v[0],O=v[1],j=Object(w.a)(re),I=Object(d.a)(j,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"button-nodec post-upload-button",onClick:function(){return c(!0)}}),r.a.createElement(ne.a,{show:n,onHide:function(){return c(!1)},size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0},r.a.createElement(ne.a.Header,{closeButton:!0},r.a.createElement(ne.a.Title,{id:"contained-modal-title-vcenter"},"Upload")),r.a.createElement(ne.a.Body,null,r.a.createElement(q.a,null,r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),I({variables:{caption:u,userId:o.sub,url:p},refetchQueries:[{query:ee},{query:Y,variables:{id:o.sub}}]}).catch(function(e){console.log(e),O(e.toString())}),s(""),b("")}},r.a.createElement(L.a,null,r.a.createElement("span",null,"Image Url (file upload is not supported currently):")),r.a.createElement(L.a,null,r.a.createElement("input",{value:p,onChange:function(e){return b(e.target.value)},type:"text"})),r.a.createElement(L.a,null,r.a.createElement("span",null,"Caption:")),r.a.createElement(L.a,null,r.a.createElement("input",{value:u,onChange:function(e){return s(e.target.value)},type:"text"})),r.a.createElement(L.a,null,r.a.createElement(T.a,{variant:"outline-dark",className:"profile-logout top-padding",type:"submit",value:"Submit",onClick:function(){return c(!1)}},"Submit")),E)))))};var oe=function(e){var t=e.component,n=e.path,a=h(),c=a.isAuthenticated,o=a.loginWithRedirect;return r.a.createElement(U.a,{path:n,render:function(){return c?r.a.createElement(t,null):(o({}),r.a.createElement("div",null))}})},le=n(17),ie=n(37),ue=n(24),se=n(34),de=n(74);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(n,!0).forEach(function(t){Object(l.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var pe=function(){var e=h().isAuthenticated,t=Object(a.useState)(""),n=Object(d.a)(t,2),c=n[0],o=n[1],l=h(),i=l.getTokenSilently;if(l.loading)return"Loading...";(function(){var e=Object(s.a)(u.a.mark(function e(){var t;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i();case 3:t=e.sent,o(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(){return e.apply(this,arguments)}})()();var m=new ie.a({uri:"https://instagram-clone-3.herokuapp.com/v1/graphql"}),g=Object(de.a)(function(e,t){var n=t.headers;return c?{headers:ge({},n,{authorization:"Bearer ".concat(c)})}:{headers:ge({},n)}}),p=new ue.a({link:g.concat(m),cache:new se.a});return r.a.createElement(le.a,{client:p},r.a.createElement(E,null),e&&r.a.createElement(ce,null),r.a.createElement(U.c,null,r.a.createElement(U.a,{exact:!0,path:"/",component:te}),r.a.createElement(U.a,{path:"/post/:id",component:C}),r.a.createElement(oe,{path:"/user/:id",component:K})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var be=n(36);o.a.render(r.a.createElement(m.a,null,r.a.createElement(function(e){var t=e.children,n=e.onRedirectCallback,c=void 0===n?f:n,o=Object(g.a)(e,["children","onRedirectCallback"]),l=Object(a.useState)(),i=Object(d.a)(l,2),m=i[0],p=i[1],h=Object(a.useState)(),E=Object(d.a)(h,2),O=E[0],j=E[1],w=Object(a.useState)(),I=Object(d.a)(w,2),y=I[0],k=I[1],_=Object(a.useState)(!0),N=Object(d.a)(_,2),S=N[0],$=N[1],P=Object(a.useState)(!1),q=Object(d.a)(P,2),x=q[0],F=q[1];Object(a.useEffect)(function(){(function(){var e=Object(s.a)(u.a.mark(function e(){var t,n,a,r,l;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b()(o);case 2:if(t=e.sent,k(t),!window.location.search.includes("code=")){e.next=10;break}return e.next=7,t.handleRedirectCallback();case 7:n=e.sent,a=n.appState,c(a);case 10:return e.next=12,t.isAuthenticated();case 12:if(r=e.sent,p(r),!r){e.next=19;break}return e.next=17,t.getUser();case 17:l=e.sent,j(l);case 19:$(!1);case 20:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()()},[]);var C=function(){var e=Object(s.a)(u.a.mark(function e(){var t,n,a=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},F(!0),e.prev=2,e.next=5,y.loginWithPopup(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error(e.t0);case 10:return e.prev=10,F(!1),e.finish(10);case 13:return e.next=15,y.getUser();case 15:n=e.sent,j(n),p(!0);case 18:case"end":return e.stop()}},e,null,[[2,7,10,13]])}));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(s.a)(u.a.mark(function e(){var t;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return $(!0),e.next=3,y.handleRedirectCallback();case 3:return e.next=5,y.getUser();case 5:t=e.sent,$(!1),p(!0),j(t);case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return r.a.createElement(v.Provider,{value:{isAuthenticated:m,user:O,loading:S,popupOpen:x,loginWithPopup:C,handleRedirectCallback:U,getIdTokenClaims:function(){return y.getIdTokenClaims.apply(y,arguments)},loginWithRedirect:function(){return y.loginWithRedirect.apply(y,arguments)},getTokenSilently:function(){return y.getTokenSilently.apply(y,arguments)},getTokenWithPopup:function(){return y.getTokenWithPopup.apply(y,arguments)},logout:function(){return y.logout.apply(y,arguments)}}},t)},{domain:be.domain,client_id:be.clientId,audience:be.audience,redirect_uri:be.redirect_uri,onRedirectCallback:function(e){window.history.replaceState({},document.title,e&&e.targetUrl?e.targetUrl:window.location.pathname)}},r.a.createElement(pe,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},29:function(e,t,n){},36:function(e){e.exports=JSON.parse('{"domain":"dev-z5h3dp-b.auth0.com","clientId":"Iv6qSZ1M6YD1a8lt0M4kbJ4BVEz0pFFF","redirect_uri":"http://localhost:3000","audience":"https://instagram-clone-3.herokuapp.com/v1/graphql"}')},75:function(e,t,n){e.exports=n(106)},80:function(e,t,n){}},[[75,1,2]]]);
//# sourceMappingURL=main.ae9dba7f.chunk.js.map